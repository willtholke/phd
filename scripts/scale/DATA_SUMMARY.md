# PHD Ecosystem Data Summary

Generated by `phd/scripts/scale/run_all.py --scale 1.0`

## Overview

PHD (Peregrine Human Data) is a human data labeling company with **$346M net ARR** and data spread across 4 databases. This document describes the generated data so you can write queries against it.

---

## Databases & Connection Strings

| Database | Purpose | Host |
|----------|---------|------|
| **PHD** | Company metadata (customers, contracts, projects, taskers, assignments) | `ep-broad-haze-aifq29n7` (Neon) |
| **SRT Tool** | Meta's annotation platform (annotations, completions, reviews) | `ep-dawn-rice-aidjsb8a` (Neon) |
| **Feather** | OpenAI's RLHF platform (tasks, submissions, quality_reviews) | `ep-green-grass-aiu49ik8` (Neon) |
| **Fairtable** | Internal platform for Google/xAI/Anthropic (tasks, submissions, reviews) | `ep-icy-snow-ai8wakfm` (Neon) |

---

## Record Counts

| Database | Table | Records |
|----------|-------|---------|
| PHD | customers | 5 |
| PHD | billing_cycles | 4 |
| PHD | spls | 21 |
| PHD | domains | 13 |
| PHD | subdomains | 145 |
| PHD | taskers | 4,332 |
| PHD | contracts | 35 (15 active) |
| PHD | projects | 112 (41 active) |
| PHD | assignments | 17,112 (15,067 active) |
| **SRT Tool** | annotations | **1,999,876** |
| **SRT Tool** | completions | **2,000,654** |
| **SRT Tool** | reviews | **2,201,099** |
| **Feather** | tasks | **1,499,900** |
| **Feather** | submissions | **1,501,389** |
| **Feather** | quality_reviews | **1,651,313** |
| **Fairtable** | tasks | **1,799,634** |
| **Fairtable** | submissions | **1,800,537** |
| **Fairtable** | reviews | **1,981,217** |
| | **TOTAL** | **~16.4M** |

---

## Revenue Model

- **$346M net ARR** = PHD's take-home after paying taskers
- 15 active contracts across 5 customers
- Average billing rate: ~$140/hr, average take rate: ~30%
- ~4,332 taskers, ~17K assignments

### Revenue by Customer

| Customer | Platform | Active Contracts | Active Budget | Avg Take Rate | Net ARR |
|----------|----------|-----------------|---------------|---------------|---------|
| Meta | SRT Tool | 3 | ~$334M | 30% | ~$101M |
| OpenAI | Feather | 3 | ~$292M | 30% | ~$88M |
| Google | Fairtable | 3 | ~$228M | 27% | ~$62M |
| xAI | Fairtable | 3 | ~$140M | 31% | ~$44M |
| Anthropic | Fairtable | 3 | ~$172M | 29% | ~$51M |

### Growth Curve

Hockey-stick growth from founding (Jul 2023) to peak ($350M ARR, Dec 2025):

| Quarter | ARR (net) |
|---------|-----------|
| Q3 2023 | $3M |
| Q4 2023 | $10M |
| Q1 2024 | $25M |
| Q2 2024 | $50M |
| Q3 2024 | $90M |
| Q4 2024 | $150M |
| Q1 2025 | $230M |
| Q2 2025 | $290M |
| Q3 2025 | $330M |
| Q4 2025 | $350M |
| Jan-Feb 2026 | $350M (run rate) |

---

## PHD Database Schema

### `customers`
| Column | Type | Description |
|--------|------|-------------|
| id | SERIAL PK | 1=Meta, 2=OpenAI, 3=Google, 4=xAI, 5=Anthropic |
| name | VARCHAR | Company name |
| platform | VARCHAR | `SRT Tool`, `Feather`, or `Airtable` |
| primary_spl_id | INTEGER FK→spls | Primary account manager |
| billing_cycle_id | INTEGER FK→billing_cycles | |

### `contracts`
| Column | Type | Description |
|--------|------|-------------|
| id | SERIAL PK | |
| customer_id | INTEGER FK→customers | |
| billing_cycle_id | INTEGER FK→billing_cycles | |
| contract_name | VARCHAR | e.g. "RLHF Preference Ranking Q3 2024" |
| start_date | DATE | |
| end_date | DATE (nullable) | NULL = ongoing |
| take_rate | REAL | PHD's commission (0.25-0.35) |
| contract_budget | DECIMAL | Total budget in USD |
| status | VARCHAR | `active`, `completed`, `canceled`, `inactive` |

### `projects`
| Column | Type | Description |
|--------|------|-------------|
| id | SERIAL PK | |
| customer_id | INTEGER FK→customers | |
| contract_id | INTEGER FK→contracts | |
| spl_id | INTEGER FK→spls | Project lead |
| external_name | VARCHAR | Client-facing name (e.g. "Llama-RLHF-v6") |
| internal_name | VARCHAR | PHD-internal name |
| start_date | DATE | |
| end_date | DATE (nullable) | |
| budget | DECIMAL | Project budget in USD |
| billing_rate | DECIMAL | $/hr charged to customer |
| subdomain_ids | INTEGER[] | FK→subdomains (expertise areas) |
| status | VARCHAR | `active`, `completed`, `cancelled`, `staffing`, `paused`, `pipeline` |
| **external_project_id** | **VARCHAR** | **Platform-specific project ID (see below)** |

#### `external_project_id` Mapping

This column links PHD projects to their representation on external platforms:

| Customer | Format | Example | Where it appears |
|----------|--------|---------|-----------------|
| Meta | `proj_srt_<8char_hash>` | `proj_srt_b0cc0282` | SRT `annotations.project_id` |
| OpenAI | `proj_f_<8char_hash>` | `proj_f_95e0dc9a` | Feather `tasks.project_id` |
| Google | `base_google` | `base_google` | Fairtable `tasks.base_id` |
| xAI | `base_xai` | `base_xai` | Fairtable `tasks.base_id` |
| Anthropic | `base_anthropic` | `base_anthropic` | Fairtable `tasks.base_id` |

**Key**: To find all tasks for a PHD project, use `external_project_id` to query the right platform:
- Meta project → query SRT `annotations` WHERE `project_id = <external_project_id>`
- OpenAI project → query Feather `tasks` WHERE `project_id = <external_project_id>`
- Google/xAI/Anthropic → query Fairtable `tasks` WHERE `base_id = <external_project_id>`

Note: For Fairtable (Google/xAI/Anthropic), multiple PHD projects map to the same `base_id` since Fairtable is multi-tenant by customer, not by project.

### `taskers`
| Column | Type | Description |
|--------|------|-------------|
| id | SERIAL PK | 1-4332 |
| first_name, middle_name, last_name | VARCHAR | |
| email | VARCHAR | `name@peregrine.io` |
| hire_date | DATE | |
| status | VARCHAR | `active` or `inactive` |
| external_job_title | VARCHAR | e.g. "Cardiologist", "Software Engineer" |
| subdomain_ids | INTEGER[] | Expertise areas |
| hours_available | DECIMAL | Weekly hours |
| hourly_rate | DECIMAL | $/hr paid to tasker |
| location_country, location_timezone | VARCHAR | |
| languages | TEXT[] | e.g. `{"English","Spanish"}` |
| language_proficiency | JSONB | e.g. `{"English":"native","Spanish":"fluent"}` |
| internal_roles | TEXT[] | `tasker`, `reviewer` |

### `assignments`
| Column | Type | Description |
|--------|------|-------------|
| id | SERIAL PK | |
| tasker_id | INTEGER FK→taskers | |
| project_id | INTEGER FK→projects | |
| assigned_date | DATE | |
| removed_date | DATE (nullable) | NULL = still active |
| status | VARCHAR | `active` or `removed` |
| removal_reason | TEXT (nullable) | Why removed |
| roles | TEXT[] | `{tasker}`, `{reviewer}`, `{tasker,reviewer}` |

### `spls` (Strategic Project Leads)
| Column | Type | Description |
|--------|------|-------------|
| id | SERIAL PK | 1-21 |
| name | VARCHAR | e.g. "Aakash Pattabi" |
| email | VARCHAR | `name@peregrine.io` |
| hire_date | DATE | |
| status | VARCHAR | `active` or `inactive` |

### `domains` (13 domains) and `subdomains` (145 subdomains)
Standard domain taxonomy: Software Engineering, Medicine, Law, Data Analysis, Finance, etc.

---

## SRT Tool Database Schema (Meta)

### `annotations` (equivalent to "tasks")
| Column | Type | Description |
|--------|------|-------------|
| annotation_id | VARCHAR PK | Format: `ann_srt_<12char_hex>` |
| project_id | VARCHAR | Format: `proj_srt_<8char_hex>` — **matches PHD `projects.external_project_id`** |
| annotator_id | VARCHAR | Format: `srt_meta_<8char_hash>` — maps to PHD tasker via `meta_id_pairing.csv` |
| annotation_type | VARCHAR | `preference_ranking`, `safety_labeling`, `prompt_response` |
| status | VARCHAR | `assigned`, `in_progress`, `completed`, `under_review`, `rejected` |
| created_at | TIMESTAMP | |
| deadline | TIMESTAMP (nullable) | |

### `completions` (equivalent to "submissions")
| Column | Type | Description |
|--------|------|-------------|
| completion_id | VARCHAR PK | Format: `comp_srt_<12char_hex>` |
| annotation_id | VARCHAR FK→annotations | |
| annotator_id | VARCHAR | `srt_meta_<hash>` |
| completed_at | TIMESTAMP | |
| duration_minutes | REAL | Time spent in **minutes** (5-60, avg ~20) |
| status | VARCHAR | `submitted`, `accepted`, `rejected`, `needs_rework` |
| rework_count | INTEGER | 0-3 |

### `reviews`
| Column | Type | Description |
|--------|------|-------------|
| review_id | VARCHAR PK | Format: `rev_srt_<12char_hex>` |
| completion_id | VARCHAR FK→completions | |
| reviewer_id | VARCHAR | `srt_meta_<hash>` (never same as completion annotator) |
| quality_score | INTEGER | **1-5 scale** (avg ~3.8) |
| quality_tier | VARCHAR | `exceptional`(5), `meets_expectations`(4), `below_expectations`(3), `unacceptable`(1-2) |
| notes | TEXT (nullable) | |
| reviewed_at | TIMESTAMP | |

---

## Feather Database Schema (OpenAI)

### `tasks`
| Column | Type | Description |
|--------|------|-------------|
| task_id | VARCHAR PK | Format: `task_f_<12char_hex>` |
| project_id | VARCHAR | Format: `proj_f_<8char_hex>` — **matches PHD `projects.external_project_id`** |
| title | VARCHAR | Task description |
| type | VARCHAR | `rlhf_ranking`, `code_review`, `text_generation` |
| assigned_to | VARCHAR | Format: `usr_<8char_hash>` — maps to PHD tasker via `feather_id_pairing.csv` |
| status | VARCHAR | `pending`, `in_progress`, `submitted`, `approved`, `rejected` |
| created_at | TIMESTAMP | |

### `submissions`
| Column | Type | Description |
|--------|------|-------------|
| submission_id | VARCHAR PK | Format: `sub_f_<12char_hex>` |
| task_id | VARCHAR FK→tasks | |
| submitted_by | VARCHAR | `usr_<hash>` |
| submitted_at | TIMESTAMP | |
| time_spent_seconds | INTEGER | Time spent in **seconds** (300-7200, avg ~1800) |
| status | VARCHAR | `pending_review`, `approved`, `rejected`, `revision_requested` |

### `quality_reviews`
| Column | Type | Description |
|--------|------|-------------|
| review_id | VARCHAR PK | Format: `rev_f_<12char_hex>` |
| submission_id | VARCHAR FK→submissions | |
| reviewer_id | VARCHAR | `usr_<hash>` (never same as submitter) |
| score | REAL | **0.0-1.0 float** (avg ~0.72) |
| rating | VARCHAR | `excellent`(≥0.85), `acceptable`(≥0.65), `needs_improvement`(≥0.4), `unacceptable`(<0.4) |
| feedback | TEXT (nullable) | |
| reviewed_at | TIMESTAMP | |

---

## Fairtable Database Schema (Google / xAI / Anthropic)

Multi-tenant: `base_id` differentiates customers.

### `tasks`
| Column | Type | Description |
|--------|------|-------------|
| record_id | VARCHAR PK | Format: `rec_<12char_hex>` |
| base_id | VARCHAR | `base_google`, `base_xai`, `base_anthropic` — **matches PHD `projects.external_project_id`** |
| task_name | VARCHAR | Task description |
| task_type | VARCHAR | Varies: `medical_evaluation`, `legal_evaluation`, `code_generation`, `red_team`, `science_evaluation`, `humanities_evaluation`, `domain_qa`, etc. |
| assigned_to | INTEGER | **PHD tasker ID directly** (no mapping needed) |
| status | VARCHAR | `todo`, `in_progress`, `done`, `reviewed` |
| created_at | TIMESTAMP | |
| due_date | DATE (nullable) | |

### `submissions`
| Column | Type | Description |
|--------|------|-------------|
| record_id | VARCHAR PK | Format: `rec_<12char_hex>` |
| base_id | VARCHAR | |
| task_record_id | VARCHAR FK→tasks | |
| submitted_by | INTEGER | PHD tasker ID |
| submitted_at | TIMESTAMP | |
| hours_logged | REAL | Time spent in **hours** (0.25-6.0, avg ~1.5) |
| status | VARCHAR | `pending`, `approved`, `rejected` |

### `reviews`
| Column | Type | Description |
|--------|------|-------------|
| record_id | VARCHAR PK | Format: `rec_<12char_hex>` |
| base_id | VARCHAR | |
| submission_record_id | VARCHAR FK→submissions | |
| reviewed_by | VARCHAR | Reviewer **name as string** (e.g. "Jamie Liu") |
| score | REAL | **0-100 float** (avg ~75) |
| status | VARCHAR | `pass`(≥70), `conditional_pass`(50-70), `fail`(<50) |
| comments | TEXT (nullable) | |
| reviewed_at | TIMESTAMP | |

---

## ID Pairing Files

Two CSV files in `phd/scripts/scale/output/` link PHD tasker IDs to external platform IDs:

### `meta_id_pairing.csv` (1,723 rows)
```
peregrine_tasker_id,meta_external_id
1,srt_meta_bqhgccr5
2,srt_meta_ckl7rgin
...
```

### `feather_id_pairing.csv` (1,674 rows)
```
peregrine_tasker_id,feather_external_id
1,usr_xkj39vm2
3,usr_cn8q4w1p
...
```

Fairtable uses PHD tasker IDs directly — no pairing file needed.

---

## Cross-Platform Quirks (Intentional)

These inconsistencies are the whole point — PHD/Peregrine normalizes across them:

| Dimension | SRT Tool (Meta) | Feather (OpenAI) | Fairtable (Google/xAI/Anthropic) |
|-----------|----------------|------------------|----------------------------------|
| Tasker IDs | `srt_meta_<hash>` | `usr_<hash>` | PHD integer IDs |
| Time tracking | **minutes** | **seconds** | **hours** |
| Quality scores | **1-5 integer** | **0.0-1.0 float** | **0-100 float** |
| Quality tiers | exceptional / meets_expectations / below_expectations / unacceptable | excellent / acceptable / needs_improvement / unacceptable | pass / conditional_pass / fail |
| Task term | "annotation" | "task" | "task" |
| Submission term | "completion" | "submission" | "submission" |
| Reviewer ID | `srt_meta_<hash>` | `usr_<hash>` | Reviewer name string |

---

## Task Complexity Patterns

| Pattern | Frequency | Submitters per task | Reviews per submission |
|---------|-----------|--------------------|-----------------------|
| Simple task | 55% | 1 | 0-1 |
| Reviewed task | 20% | 1 | 2-3 |
| Multi-worker | 10% | 2-3 | 1 |
| Multi-worker + multi-review | 5% | 2-3 | 2-3 |
| Unsubmitted (in-progress/assigned) | 10% | 0 | 0 |

---

## Example Queries

### Find all tasks for a specific PHD project (cross-platform)
```sql
-- 1. Get the project's external ID from PHD
SELECT id, external_name, external_project_id, customer_id
FROM projects WHERE id = 5;

-- 2a. If Meta (customer_id=1), query SRT:
SELECT * FROM annotations WHERE project_id = 'proj_srt_b0cc0282';

-- 2b. If OpenAI (customer_id=2), query Feather:
SELECT * FROM tasks WHERE project_id = 'proj_f_95e0dc9a';

-- 2c. If Google/xAI/Anthropic (customer_id=3,4,5), query Fairtable:
SELECT * FROM tasks WHERE base_id = 'base_google';
```

### Revenue by customer (PHD DB)
```sql
SELECT c.name, COUNT(ct.id) as contracts,
       SUM(ct.contract_budget) as total_budget,
       AVG(ct.take_rate) as avg_take,
       SUM(ct.contract_budget * ct.take_rate) as net_revenue
FROM contracts ct
JOIN customers c ON ct.customer_id = c.id
WHERE ct.status = 'active'
GROUP BY c.name;
```

### Task volume over time (SRT example)
```sql
SELECT DATE_TRUNC('month', created_at) as month,
       COUNT(*) as annotations
FROM annotations
GROUP BY month
ORDER BY month;
```

### Match SRT annotator to PHD tasker
Use `meta_id_pairing.csv` to join:
- SRT `annotations.annotator_id` → CSV `meta_external_id` → CSV `peregrine_tasker_id` → PHD `taskers.id`
